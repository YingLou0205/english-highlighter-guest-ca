(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[708],{3465:function(e,s,t){Promise.resolve().then(t.bind(t,8364))},9376:function(e,s,t){"use strict";var a=t(5475);t.o(a,"useSearchParams")&&t.d(s,{useSearchParams:function(){return a.useSearchParams}})},8364:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return d}});var a,n=t(7437),r=t(2265),i=t(9376),l=t(5526);let c=null!==(a=t(257).env.NEXT_PUBLIC_BASE_PATH)&&void 0!==a?a:"";function d(){return(0,n.jsx)(r.Suspense,{fallback:(0,n.jsx)("div",{}),children:(0,n.jsx)(o,{})})}function o(){var e;let s=(0,i.useSearchParams)().get("code")||"",[t,a]=(0,r.useState)(null),[d,o]=(0,r.useState)([]),[u,m]=(0,r.useState)(""),[x,h]=(0,r.useState)(!0),[p,g]=(0,r.useState)([]);(0,r.useEffect)(()=>{if(!s){m("Missing code.");return}let e=!1;return(async()=>{h(!0),m("");let{data:t,error:n}=await l.O.from("documents").select("id,title,short_code").eq("short_code",s).single();if(n){e||(m(n.message),h(!1));return}if(e)return;a(t);let{data:r,error:i}=await l.O.from("paragraphs").select("id,text,idx").eq("document_id",t.id).order("idx",{ascending:!0});if(i){e||(m(i.message),h(!1));return}if(e)return;o((null!=r?r:[]).map(e=>({id:e.id,text:e.text})));let{data:c,error:d}=await l.O.from("highlights").select("paragraph_id,text,kind").eq("document_id",t.id);if(d){e||(m(d.message),h(!1));return}e||(g(null!=c?c:[]),h(!1))})(),()=>{e=!0}},[s]);let{wordCounts:f,sentenceCounts:j,maxWord:N,maxSentence:v}=(0,r.useMemo)(()=>{let e=new Map,s=new Map;for(let n of p){var t,a;if(!(null==n?void 0:n.text))continue;let r=n.text.trim();r&&("word"===n.kind?e.set(r,(null!==(t=e.get(r))&&void 0!==t?t:0)+1):("sentence"===n.kind||"span"===n.kind)&&s.set(r,(null!==(a=s.get(r))&&void 0!==a?a:0)+1))}let n=Array.from(e.values()).reduce((e,s)=>Math.max(e,s),0),r=Array.from(s.values()).reduce((e,s)=>Math.max(e,s),0);return{wordCounts:e,sentenceCounts:s,maxWord:n,maxSentence:r}},[p]),y=(0,r.useMemo)(()=>Array.from(f.entries()).sort((e,s)=>s[1]-e[1]).slice(0,10),[f]),b=(0,r.useMemo)(()=>Array.from(j.entries()).sort((e,s)=>s[1]-e[1]).slice(0,10),[j]);return(0,n.jsxs)("main",{className:"max-w-5xl mx-auto px-4 py-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between gap-4 mb-6",children:[(0,n.jsx)("h1",{className:"text-xl font-semibold",children:null!==(e=null==t?void 0:t.title)&&void 0!==e?e:"Teacher"}),(0,n.jsx)("div",{className:"flex items-center gap-2",children:(0,n.jsx)("a",{className:"px-3 py-2 rounded-md bg-black text-white hover:bg-neutral-900",href:"".concat(c,"/s?code=").concat(s),children:"Open Student View"})})]}),u&&(0,n.jsx)("div",{className:"text-red-600 mb-4",children:u}),x&&(0,n.jsx)("div",{className:"text-gray-500",children:"Loadingâ€¦"}),!x&&0===d.length&&(0,n.jsx)("div",{className:"text-gray-600",children:"No document content yet."}),(0,n.jsx)("div",{className:"space-y-6",children:d.map(e=>{let s=function(e){let s=e.match(/[^.!?]+[.!?]|\S+$/g);return null!=s?s:[e]}(e.text);return(0,n.jsx)("div",{className:"leading-7 space-y-1",children:s.map((e,s)=>{var t,a;let r=e.trim(),i=(a=null!==(t=j.get(r))&&void 0!==t?t:0)<=0||v<=0?"transparent":"hsl(210 90% ".concat(95-45*Math.max(0,Math.min(1,a/v)),"%)"),l=e.split(/(\s+)/);return(0,n.jsx)("span",{style:{backgroundColor:i,borderRadius:6,padding:"0 2px"},children:l.map((e,s)=>{var t,a;if(/\s+/.test(e))return(0,n.jsx)("span",{children:e},s);let r=(a=null!==(t=f.get(e))&&void 0!==t?t:0)<=0||N<=0?"transparent":"hsl(210 90% ".concat(92-55*Math.max(0,Math.min(1,a/N)),"%)");return(0,n.jsx)("span",{style:{backgroundColor:r,borderRadius:4,padding:"0 2px"},children:e},s)})},s)})},e.id)})}),(0,n.jsxs)("div",{className:"grid md:grid-cols-2 gap-6 mt-10",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"font-semibold mb-2",children:"Top Sentences / Spans"}),(0,n.jsxs)("ol",{className:"space-y-2",children:[b.map((e,s)=>{let[t,a]=e;return(0,n.jsxs)("li",{className:"flex items-start gap-2",children:[(0,n.jsx)("span",{className:"mt-1 text-xs w-6 shrink-0 text-gray-500",children:a}),(0,n.jsx)("span",{className:"bg-gray-50 rounded-md px-2 py-1",children:t})]},s)}),0===b.length&&(0,n.jsx)("li",{className:"text-gray-500",children:"No sentence/span highlights yet."})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"font-semibold mb-2",children:"Top Words"}),(0,n.jsxs)("ol",{className:"space-y-2",children:[y.map((e,s)=>{let[t,a]=e;return(0,n.jsxs)("li",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-xs w-6 shrink-0 text-gray-500",children:a}),(0,n.jsx)("span",{className:"bg-gray-50 rounded-md px-2 py-1",children:t})]},s)}),0===y.length&&(0,n.jsx)("li",{className:"text-gray-500",children:"No word highlights yet."})]})]})]})]})}},5526:function(e,s,t){"use strict";t.d(s,{O:function(){return a}});let a=(0,t(8439).eI)("https://jjbsscygzuomnsfpzzex.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpqYnNzY3lnenVvbW5zZnB6emV4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYwMzQzMDksImV4cCI6MjA3MTYxMDMwOX0.kd3D0KsN0iekbJ9uPTEuQ0BTxAvopleychGiQ99ytsk")}},function(e){e.O(0,[439,971,117,744],function(){return e(e.s=3465)}),_N_E=e.O()}]);