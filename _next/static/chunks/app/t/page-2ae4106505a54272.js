(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[708],{3465:function(e,s,t){Promise.resolve().then(t.bind(t,9782))},9376:function(e,s,t){"use strict";var n=t(5475);t.o(n,"useSearchParams")&&t.d(s,{useSearchParams:function(){return n.useSearchParams}})},9782:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return h}});var n=t(7437),a=t(2265),i=t(9376),c=t(5526);async function r(e){let{data:s,error:t}=await c.O.from("v_sentence_highlight_counts").select("*").eq("document_id",e).order("freq",{ascending:!1});if(t)throw t;return s}async function l(e){let{data:s,error:t}=await c.O.from("highlights").select("text, kind, created_at, user:profiles(full_name, id), paragraph_id").eq("document_id",e).order("created_at",{ascending:!1});if(t)throw t;return s}async function d(e){let{data:s,error:t}=await c.O.rpc("word_freq",{doc:e});if(t)throw t;return s}function o(e){let{items:s}=e,t=Math.max(1,...s.map(e=>e.cnt)),a=[...s];return a.sort((e,s)=>e.word>s.word?1:-1),(0,n.jsx)("div",{className:"flex flex-wrap gap-x-3 gap-y-2 p-3 rounded-xl bg-slate-50 border border-slate-200",style:{lineHeight:1.1},children:a.map((e,s)=>{let a=12+Math.round(e.cnt/t*28),i=.6+e.cnt/t*.4;return(0,n.jsx)("span",{className:"select-none",style:{fontSize:a,opacity:i},title:"".concat(e.word," \xd7").concat(e.cnt),children:e.word},s)})})}function u(){let e=((0,i.useSearchParams)().get("code")||"").trim(),[s,t]=(0,a.useState)(null),[u,h]=(0,a.useState)("Document"),[m,x]=(0,a.useState)([]),[f,p]=(0,a.useState)([]),[j,N]=(0,a.useState)([]),[y,g]=(0,a.useState)("");return((0,a.useEffect)(()=>{(async()=>{g("");let{data:s,error:n}=await c.O.from("documents").select("id,title").eq("short_code",e).maybeSingle();if(n){g(n.message);return}if(!s){g("Document not found for this code.");return}t(s.id),s.title&&h(s.title);try{let[e,t,n]=await Promise.all([r(s.id),l(s.id),d(s.id)]);x(e),p(t),N(n)}catch(e){var a;g(null!==(a=e.message)&&void 0!==a?a:String(e))}})()},[e]),e)?y?(0,n.jsx)("div",{className:"container py-10 text-red-600",children:y}):s?(0,n.jsxs)("main",{className:"container py-10 space-y-10",children:[(0,n.jsx)("h1",{className:"text-xl font-semibold",children:u}),(0,n.jsxs)("section",{className:"space-y-2",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold",children:"Top Sentences / Spans"}),(0,n.jsx)("ul",{className:"space-y-1",children:m.map((e,s)=>(0,n.jsxs)("li",{className:"text-sm",children:[(0,n.jsx)("span",{className:"font-medium",children:e.example_text})," ",(0,n.jsxs)("span",{className:"text-gray-600",children:["\xd7",e.freq]})]},s))})]}),(0,n.jsxs)("section",{className:"space-y-2",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold",children:"Word Cloud"}),(0,n.jsx)(o,{items:j})]}),(0,n.jsxs)("section",{className:"space-y-2",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold",children:"Who highlighted what"}),(0,n.jsxs)("table",{className:"table",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"User"}),(0,n.jsx)("th",{children:"Kind"}),(0,n.jsx)("th",{children:"Text"}),(0,n.jsx)("th",{children:"Time"})]})}),(0,n.jsx)("tbody",{children:f.map((e,s)=>{var t,a,i;return(0,n.jsxs)("tr",{className:"border-t",children:[(0,n.jsx)("td",{children:null!==(i=null===(t=e.user)||void 0===t?void 0:t.full_name)&&void 0!==i?i:null===(a=e.user)||void 0===a?void 0:a.id}),(0,n.jsx)("td",{className:"text-center",children:e.kind}),(0,n.jsx)("td",{className:"font-medium",children:e.text}),(0,n.jsx)("td",{className:"text-gray-600",children:new Date(e.created_at).toLocaleString()})]},s)})})]})]})]}):(0,n.jsx)("div",{className:"container py-10",children:"Loading…"}):(0,n.jsxs)("div",{className:"container py-10",children:["Missing ",(0,n.jsx)("code",{children:"code"})," in URL."]})}function h(){return(0,n.jsx)(a.Suspense,{fallback:(0,n.jsx)("div",{className:"container py-10",children:"Loading…"}),children:(0,n.jsx)(u,{})})}},5526:function(e,s,t){"use strict";t.d(s,{O:function(){return n}});let n=(0,t(8439).eI)("https://jjbsscygzuomnsfpzzex.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpqYnNzY3lnenVvbW5zZnB6emV4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYwMzQzMDksImV4cCI6MjA3MTYxMDMwOX0.kd3D0KsN0iekbJ9uPTEuQ0BTxAvopleychGiQ99ytsk")}},function(e){e.O(0,[439,971,117,744],function(){return e(e.s=3465)}),_N_E=e.O()}]);