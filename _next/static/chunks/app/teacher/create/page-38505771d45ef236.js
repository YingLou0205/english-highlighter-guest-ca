(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[696],{6465:function(e,t,s){Promise.resolve().then(s.bind(s,4985))},4985:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return l}});var a=s(7437),i=s(2265),n=s(5526);function l(){let[e,t]=(0,i.useState)(null),[s,l]=(0,i.useState)(""),[r,c]=(0,i.useState)("teacher"),[d,o]=(0,i.useState)(""),[u,m]=(0,i.useState)(""),[h,x]=(0,i.useState)(!1),[p,g]=(0,i.useState)(null),[f,v]=(0,i.useState)(null),[N,b]=(0,i.useState)("");async function j(){var t;(null==e?void 0:e.user)&&(await n.O.from("profiles").upsert({id:e.user.id,full_name:s.trim()||(null!==(t=e.user.email)&&void 0!==t?t:"Guest"),role:r}),b("Name saved."),setTimeout(()=>b(""),1500))}async function y(t){var a,i,l,c;if(t.preventDefault(),b(""),!(null==e?void 0:e.user)){b("Please sign in first.");return}if(!d.trim()||!u.trim()){b("Title and content are required.");return}x(!0);try{await n.O.from("profiles").upsert({id:e.user.id,full_name:s.trim()||(null!==(a=e.user.email)&&void 0!==a?a:"Guest"),role:r});let{data:t,error:c}=await n.O.from("documents").insert({title:d,content:u,created_by:e.user.id}).select("id, short_code").maybeSingle();if(c)throw c;if(!t)throw Error("Insert failed.");g(t.id),v(null!==(i=t.short_code)&&void 0!==i?i:t.id.slice(0,8));let o=u.split(/\n\s*\n+/).map(e=>e.trim()).filter(Boolean);if(o.length){let e=o.map((e,s)=>({document_id:t.id,idx:s,text:e})),{error:s}=await n.O.from("paragraphs").insert(e);if(s)throw s}try{await navigator.clipboard.writeText(null!==(l=t.short_code)&&void 0!==l?l:t.id.slice(0,8))}catch(e){}}catch(e){b(null!==(c=e.message)&&void 0!==c?c:String(e))}finally{x(!1)}}return(0,i.useEffect)(()=>{let e=n.O.auth.onAuthStateChange((e,s)=>t(s)).data;return(async()=>{let{data:{session:e}}=await n.O.auth.getSession();e?t(e):await n.O.auth.signInAnonymously()})(),()=>{e.subscription.unsubscribe()}},[]),(0,a.jsxs)("main",{className:"container py-10 space-y-8",children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold",children:"Create a Document"}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"card space-y-3",children:[(0,a.jsx)("div",{className:"text-sm font-medium",children:"Your display name (shown to class)"}),(0,a.jsx)("input",{className:"input",placeholder:"e.g., Ying",value:s,onChange:e=>l(e.target.value)}),(0,a.jsx)("button",{className:"btn w-max",onClick:j,children:"Save name"}),N&&(0,a.jsx)("div",{className:"text-xs text-gray-600",children:N})]}),(0,a.jsxs)("div",{className:"card space-y-3",children:[(0,a.jsx)("div",{className:"text-sm font-medium",children:"Your role"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{type:"button",className:"btn ".concat("student"===r?"bg-gray-900 text-white":""),onClick:()=>c("student"),children:"Student"}),(0,a.jsx)("button",{type:"button",className:"btn ".concat("teacher"===r?"bg-gray-900 text-white":""),onClick:()=>c("teacher"),children:"Teacher"})]}),(0,a.jsx)("div",{className:"text-xs text-gray-600",children:"This sets your profile role. Document ownership is based on who creates it."})]})]}),(0,a.jsxs)("form",{onSubmit:y,className:"card max-w-2xl space-y-4",children:[(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("div",{className:"text-sm font-medium",children:"Title"}),(0,a.jsx)("input",{className:"input mt-1",value:d,onChange:e=>o(e.target.value),placeholder:"e.g., Chapter 1"})]}),(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("div",{className:"text-sm font-medium",children:"Content (blank line = new paragraph)"}),(0,a.jsx)("textarea",{className:"input mt-1",rows:10,value:u,onChange:e=>m(e.target.value),placeholder:"Paragraph 1...\n\nParagraph 2..."})]}),(0,a.jsx)("button",{className:"btn",disabled:h,type:"submit",children:h?"Creating…":"Create document"}),!(null==e?void 0:e.user)&&(0,a.jsx)("div",{className:"text-xs text-gray-600",children:"You’re not signed in yet. The page will auto-sign you in as a guest."})]}),p&&(0,a.jsxs)("div",{className:"card max-w-3xl",children:[(0,a.jsx)("div",{className:"text-green-700 text-sm",children:"✅ Document created."}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-4 mt-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"Document ID"}),(0,a.jsxs)("div",{className:"flex gap-2 mt-1",children:[(0,a.jsx)("code",{className:"input",children:p}),(0,a.jsx)("button",{className:"btn",onClick:()=>navigator.clipboard.writeText(p),children:"Copy"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"Short Code"}),(0,a.jsxs)("div",{className:"flex gap-2 mt-1",children:[(0,a.jsx)("code",{className:"input",children:f}),(0,a.jsx)("button",{className:"btn",onClick:()=>navigator.clipboard.writeText(null!=f?f:""),children:"Copy"})]}),(0,a.jsx)("div",{className:"text-[11px] text-gray-500 mt-1",children:"Tip: Short Code was copied automatically."})]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-3 mt-4",children:[(0,a.jsx)("a",{className:"btn",href:f?"s.html?code=".concat(f):"#",children:"Open Student View"}),(0,a.jsx)("a",{className:"btn",href:f?"t.html?code=".concat(f):"#",children:"Open Teacher View"})]})]})]})}},5526:function(e,t,s){"use strict";s.d(t,{O:function(){return a}});let a=(0,s(8439).eI)("https://jjbsscygzuomnsfpzzex.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpqYnNzY3lnenVvbW5zZnB6emV4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYwMzQzMDksImV4cCI6MjA3MTYxMDMwOX0.kd3D0KsN0iekbJ9uPTEuQ0BTxAvopleychGiQ99ytsk")}},function(e){e.O(0,[439,971,117,744],function(){return e(e.s=6465)}),_N_E=e.O()}]);