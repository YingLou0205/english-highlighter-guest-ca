<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>English Highlighter</title>
<link rel="icon" href="data:," />
<style>
  :root{--bg:#fff;--text:#0b1220;--muted:#5b6472;--card:#f6f7f9;--line:#e7e9ee;--btn:#0b1220;--btnText:#fff;--chip:#eef2ff}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--text);
    font:16px/1.55 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji",sans-serif}
  .container{max-width:980px;margin:40px auto;padding:0 20px}
  h1{font-size:34px;margin:0 0 22px}
  .card{background:#fff;border:1px solid var(--line);border-radius:16px;padding:18px 18px}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .input{width:100%;padding:12px 14px;border:1px solid var(--line);border-radius:12px;font:inherit}
  .btn{appearance:none;border:0;border-radius:12px;background:var(--btn);color:var(--btnText);padding:12px 16px;font-weight:600;cursor:pointer}
  .hint{color:var(--muted);font-size:13px}
  .col{flex:1 1 320px}
</style>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  // ── EDIT THESE TWO ───────────────────────────────────────────────
  const SUPABASE_URL  = "YOUR_SUPABASE_URL";
  const SUPABASE_ANON = "YOUR_SUPABASE_ANON_KEY";
  // base path for GitHub Pages repo (keeps links correct)
  const BASE = "/english-highlighter-guest-ca";
  // ─────────────────────────────────────────────────────────────────
  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON, {
    auth: { persistSession: true, autoRefreshToken: true }
  });

  // Lightweight “guest” auth: keep random email+password in localStorage.
  async function ensureSession(){
    const { data:{ session } } = await supabase.auth.getSession();
    if (session) return session.user;
    let creds = JSON.parse(localStorage.getItem("guestCreds")||"{}");
    if(!creds.email || !creds.password){
      creds = { email: `guest+${crypto.randomUUID()}@guest.local`, password: crypto.randomUUID() };
      localStorage.setItem("guestCreds", JSON.stringify(creds));
    }
    // try sign-in; if it fails, sign-up (email confirmations must be OFF)
    let { error } = await supabase.auth.signInWithPassword(creds);
    if (error) {
      const r = await supabase.auth.signUp({ email: creds.email, password: creds.password, options:{ data:{ display_name:"Guest" } } });
      if (r.error) alert("Sign-up failed: " + r.error.message);
    }
    const u = (await supabase.auth.getUser()).data.user;
    // ensure profile row exists (so teacher can see names)
    await supabase.from("profiles").upsert({ id: u.id, full_name: "Guest" });
    return u;
  }

  document.addEventListener("DOMContentLoaded", async () => {
    const codeInput = document.getElementById("code");
    await ensureSession();
    // Wire buttons
    document.getElementById("openS").onclick = () => {
      const code = codeInput.value.trim();
      if (!code) return;
      location.href = `${BASE}/s.html?code=${encodeURIComponent(code)}`;
    };
    document.getElementById("openT").onclick = () => {
      const code = codeInput.value.trim();
      if (!code) return;
      location.href = `${BASE}/t.html?code=${encodeURIComponent(code)}`;
    };
    document.getElementById("openCreate").onclick = () => {
      location.href = `${BASE}/teacher/create.html`;
    };
  });
</script>
</head>
<body>
  <main class="container">
    <h1>English Class Highlighter</h1>

    <section class="card" style="margin-bottom:18px">
      <div class="row">
        <button id="openCreate" class="btn">Open Create Page</button>
      </div>
    </section>

    <section class="card">
      <div class="row">
        <div class="col">
          <label class="hint">Open with Short Code</label>
          <input id="code" class="input" placeholder="e.g. 9ab123cd" />
        </div>
      </div>
      <div class="row" style="margin-top:10px">
        <button id="openS" class="btn">Student: Open</button>
        <button id="openT" class="btn">Teacher: Open</button>
      </div>
      <p class="hint" style="margin-top:8px">Ask the teacher for the short code (8 characters).</p>
    </section>
  </main>
</body>
</html>
